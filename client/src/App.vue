<template>
  <div id="app">
    <router-view></router-view>
    <footer> 
      <ul class="links">
        <li v-if="isAsound"> 
          <audio :src="sound" autoplay loop ref="audio"></audio>
          <div @click="mute($refs.audio, soundIcon)" :class="soundIcon"></div>
        </li>
        <li @click="fullScreen()" v-if="isFullScreen">
          <svg width="20" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.6901 13.7867H19.7192C20.0527 13.7867 20.3233 13.5184 20.3233 13.1879C20.3233 12.8574 20.0527 12.5891 19.7192 12.5891H14.5842C14.2508 12.5891 13.8291 12.9711 13.8291 13.302V18.3916C13.8291 18.7222 14.0997 18.9904 14.4332 18.9904C14.7667 18.9904 15.0373 18.7222 15.0373 18.3916V15.0968L19.8829 19.8245C20.001 19.9416 20.1931 20 20.3478 20C20.5024 20 20.6758 19.9416 20.7939 19.8245C21.0298 19.5907 21.0392 19.1548 20.8033 18.9207L15.6901 13.7867Z" fill="white"/>
            <path d="M6.62676 12.5891H1.49178C1.15831 12.5891 0.887671 12.8574 0.887671 13.1879C0.887671 13.5184 1.15831 13.7867 1.49178 13.7867H5.29921L0.17693 18.9207C-0.0589767 19.1545 -0.0589767 19.562 0.17693 19.7958C0.294732 19.9128 0.449386 19.9853 0.604039 19.9853C0.758692 19.9853 0.837831 19.9341 0.955633 19.817L5.87131 14.8771V18.3913C5.87131 18.7219 6.14195 18.9901 6.47542 18.9901C6.8089 18.9901 7.07954 18.7219 7.07954 18.3913V13.3017C7.07984 12.9711 6.96023 12.5891 6.62676 12.5891Z" fill="white"/>
            <path d="M19.9112 0.190193L15.0656 4.91819V1.6629C15.0656 1.33237 14.795 1.06412 14.4615 1.06412C14.1281 1.06412 13.8574 1.33237 13.8574 1.6629V6.75257C13.8574 7.0831 14.2791 7.23728 14.6126 7.23728H19.7475C20.081 7.23728 20.3516 6.96903 20.3516 6.6385C20.3516 6.30797 20.081 6.03972 19.7475 6.03972H15.6785L20.841 0.979988C21.0769 0.746163 21.0391 0.395875 20.8032 0.162049C20.5676 -0.0720752 20.1469 -0.0436324 19.9112 0.190193Z" fill="white"/>
            <path d="M6.5041 1.04929C6.17063 1.04929 5.89998 1.31755 5.89998 1.64808V5.12283L0.984306 0.175369C0.748701 -0.0584564 0.403449 -0.0584564 0.167845 0.175369C-0.068062 0.409194 -0.0493344 0.73104 0.186572 0.965165L5.36746 6.0249H1.52015C1.18668 6.0249 0.91604 6.29315 0.91604 6.62368C0.91604 6.95421 1.18668 7.22247 1.52015 7.22247H6.65513C6.9886 7.22247 7.10821 7.06828 7.10821 6.73775V1.64808C7.10821 1.31725 6.83757 1.04929 6.5041 1.04929Z" fill="white"/>
          </svg>
        </li>
        <li @click="fullScreen()" v-else>
          <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0)">
            <path d="M1.93846 0.895081H4.92333C5.17038 0.895081 5.37087 0.694583 5.37087 0.44754C5.37087 0.200498 5.17038 0 4.92333 0H1.11924C0.872198 0 0.559814 0.285531 0.559814 0.532797V4.33689C0.559814 4.58393 0.760313 4.78443 1.00735 4.78443C1.2544 4.78443 1.4549 4.58393 1.4549 4.33689V1.8743L5.04462 5.40785C5.13211 5.49535 5.27443 5.53898 5.389 5.53898C5.50357 5.53898 5.63201 5.49535 5.71951 5.40785C5.89427 5.23309 5.90121 4.90728 5.72645 4.73229L1.93846 0.895081Z" fill="white"/>
            <path d="M15.4405 0H11.6364C11.3894 0 11.1889 0.200498 11.1889 0.44754C11.1889 0.694583 11.3894 0.895081 11.6364 0.895081H14.457L10.6623 4.73229C10.4876 4.90706 10.4876 5.21161 10.6623 5.38637C10.7496 5.47387 10.8642 5.52802 10.9787 5.52802C11.0933 5.52802 11.1519 5.48976 11.2392 5.40226L14.8808 1.71005V4.33667C14.8808 4.58371 15.0813 4.78421 15.3284 4.78421C15.5754 4.78421 15.7759 4.58371 15.7759 4.33667V0.532573C15.7761 0.285531 15.6875 0 15.4405 0Z" fill="white"/>
            <path d="M5.04462 9.94928L1.4549 13.4831V11.05C1.4549 10.803 1.2544 10.6025 1.00735 10.6025C0.760313 10.6025 0.559814 10.803 0.559814 11.05V14.8541C0.559814 15.1011 0.872198 15.2164 1.11924 15.2164H4.92333C5.17038 15.2164 5.37087 15.0159 5.37087 14.7688C5.37087 14.5218 5.17038 14.3213 4.92333 14.3213H1.90893L5.73338 10.5396C5.90815 10.3648 5.88018 10.103 5.70541 9.92825C5.53087 9.75326 5.21916 9.77452 5.04462 9.94928Z" fill="white"/>
            <path d="M15.3286 10.6025C15.0816 10.6025 14.8811 10.803 14.8811 11.05V13.6471L11.2394 9.94928C11.0649 9.77452 10.8091 9.77452 10.6346 9.94928C10.4598 10.124 10.4737 10.3646 10.6485 10.5396L14.4866 14.3213H11.6364C11.3894 14.3213 11.1889 14.5218 11.1889 14.7688C11.1889 15.0159 11.3894 15.2164 11.6364 15.2164H15.4405C15.6876 15.2164 15.7762 15.1011 15.7762 14.8541V11.05C15.7762 10.8027 15.5757 10.6025 15.3286 10.6025Z" fill="white"/>
            </g>
            <defs>
            <clipPath id="clip0">
            <rect width="15.2164" height="15.2164" fill="white" transform="translate(0.559814)"/>
            </clipPath>
            </defs>
          </svg>
        </li>
      </ul>
    </footer>
  </div>
</template>

<script>

import screenService from './screenService'
import soundService from './soundService'

export default {
  data() {
    return {
      isFullScreen: this.screenState(),
      sound: require('./assets/audio/ambient.mp3'),
      soundIcon: "sound-icon",
      isAsound : this.availableAudio()
    }
  },
  methods: {
    fullScreen() {
      if (this.isFullScreen) {
        screenService.toWindowedScreen()
      } else {
        let screen = document.documentElement
        screenService.toFullScreen(screen)
      }
    },
    screenState() {
      let screenState = document.fullScreen || document.mozFullScreen || document.webkitIsFullScreen
      return screenState
    },
    mute(audio, icon) {
      this.soundIcon = soundService.mute(audio, icon)
    },
    availableAudio() {
      if (this.$route.fullPath === "/chapters" || this.$route.fullPath === "/earth" || this.$route.fullPath === "/game") {
        return true
      } else {
        return false
      }
    }
  },
  mounted() {
    document.addEventListener("fullscreenchange", () => {
      if (document.fullscreenElement) {
        this.isFullScreen = true
      } else {
        this.isFullScreen = false
      }
    });

    //restore sounds settings
    if (this.isAsound) {
      this.soundIcon = soundService.restoreAudioSettings(this.$refs.audio, this.soundIcon);
    }
  },
  updated() {
    this.isAsound = this.availableAudio();
  }
}
</script>